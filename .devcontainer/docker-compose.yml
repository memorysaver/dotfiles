services:
  dev:
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile
    working_dir: /workspace
    cap_add:
      - NET_ADMIN
      - NET_RAW
    volumes:
      - ..:/workspace
      - ../claude:/home/node/.claude:rw
      - ../opencode/config.json:/home/node/.config/opencode/config.json:rw
      - ../openai-codex/config.toml:/home/node/.codex/config.toml:rw
      - command-history:/commandhistory
      - opencode-data:/home/node/.local/share/opencode
      - uv-cache:/home/node/.cache/uv
      - uv-data:/home/node/.local/share/uv
      - bun-cache:/home/node/.bun
      - npm-cache:/home/node/.npm
    environment:
      OPENCODE_CONFIG: /home/node/.config/opencode/config.json
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY:-}
      GROQ_API_KEY: ${GROQ_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
    ports:
      - "4096:4096"
    tty: true
    stdin_open: true

volumes:
  command-history:
  opencode-data:
  uv-cache:
  uv-data:
  bun-cache:
  npm-cache:
